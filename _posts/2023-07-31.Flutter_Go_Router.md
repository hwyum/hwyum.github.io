---
title: "[Flutter] Go Router"
date: 2023-07-31
tags:
    - flutter
categories: 
    - flutter
---

# go_router 사용 관련 정리

**아래의 Medium Article 내용을 번역/정리한 것임을 미리 밝힙니다.** 

https://medium.com/@antonio.tioypedro1234/flutter-go-router-the-essential-guide-349ef39ec5b3



## Route Configuration

Route 속성을 정의한다. 

```dart
import 'package:go_router/go_router.dart';

// GoRouter configuration
final _router = GoRouter(
  initialLocation: '/',
  routes: [
    GoRoute(
      name: 'home', // Optional, add name to your routes. Allows you navigate by name instead of path
      path: '/',
      builder: (context, state) => HomeScreen(),
    ),
    GoRoute(
      name: 'page2',
      path: '/page2',
      builder: (context, state) => Page2Screen(),
    ),
  ],
);
```

 `MaterialApp.router`이나 `CupertinoApp.router` 생성자를 사용해서 앱을 빌드할 때 위에서 정의한 _router를 `routerConfig`라는 parameter로 넘겨주게 된다. 

```dart
class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      routerConfig: _router,
    );
  }
}
```

### Parameters

아래와 같이 path parameter를 `:`캐릭터를 사용해 정의할 수 있다. 

```dart
GoRoute(
  path: '/fruits/:id',
  builder: (context, state) {
     final id = state.params['id'] // Get "id" param from URL
     return FruitsPage(id: id);
  },
),
```

`GoRouterState`를 활용해 Query string parameter에도 access 할 수 있다. 예를 들어서 `/fruits?search=antonio`는 `search`파라메터를 읽을 수 있다. 

```dart
GoRoute(
  path: '/fruits',
  builder: (context, state) {
    final search = state.queryParams['search'];
    return FruitsPage(search: search);
  },
),
```

### Adding child routes

`push()`와 마찬가지로, 원 화면이 있고, 그 위에 새로운 화면을 띄울 수 있게 (back button 사용 가능하도록) 한개 이상의 스크린으로도 라우팅 시킬 수 있다. 

이를 위해 child route와 parent route를 설정할 수 있다. 

```dart
GoRoute(
  path: '/fruits',
  builder: (context, state){
    return FruitsPage();
  },
  routes: <RouteBase>[ // Add child routes
    GoRoute(
      path: 'fruits-details', // Note: Don't need to specify "/" character for router's parents
      builder: (context, state) {
        return FruitDetailsPage();
      }
    )
  ]
)
```

### Navigation Between Screens

Go_router를 활용해 navigate하는 데에는 여러 방법이 존재한다. 

새로운 스크린으로 전환하려면,  `context.go()`에 URL을 주면 된다. 

```dart
build(BuildContext context) {
  return TextButton(
    onPressed: () => context.go('/fruits/fruit-detail'),    
  );
}
```

URL대신 이름으로 화면 전환도 가능하다. 

```dart
build(BuildContext context) {
  return TextButton(
    // remember to add "name" to your routes
    onPressed: () => context.goNamed('fruit-detail'),
  );
}
```

## Nested Tab navigation

탭별로 분기된 navigation을 정의할 수도 있다. (bottom navigator를 사용하는 경우, 각 탭별로 navigation tree를 유지해야 하는 경우가 있을 수 있다. )

이러한 nested navigation (<- 왼쪽 단어가 잘 와닿지는 않는다.)을 구현하기 위해서 [`StatefulShellRoute`](https://pub.dev/documentation/go_router/latest/go_router/StatefulShellRoute-class.html)를 활용할 수 있다. 

[`StatefulShellRoute`](https://pub.dev/documentation/go_router/latest/go_router/StatefulShellRoute-class.html)는 `StatefulShellBranch`의 List를 정의함으로써 생성된다. `StatefulShellBranch`는 roote routes와 각 브랜치별 Navigator key(GlobalKey)와 선택적인 initial location(?)을 제공한다. 

router를 생성할 때, StatefulShellRoute.indexedStack() 생성자를 사용하게 된다. 

```dart
// Create keys for `root` & `section` navigator avoiding unnecessary rebuilds
final _rootNavigatorKey = GlobalKey<NavigatorState>();
final _sectionNavigatorKey = GlobalKey<NavigatorState>();


final router = GoRouter(
  navigatorKey: _rootNavigatorKey,
  initialLocation: '/feed',
  routes: <RouteBase>[
    StatefulShellRoute.indexedStack(
      builder: (context, state, navigationShell) {
        // Return the widget that implements the custom shell (e.g a BottomNavigationBar).
        // The [StatefulNavigationShell] is passed to be able to navigate to other branches in a stateful way.
        return ScaffoldWithNavbar(navigationShell);
      },
      branches: [
        // The route branch for the 1º Tab
        StatefulShellBranch(
          navigatorKey: _sectionNavigatorKey,
          // Add this branch routes
          // each routes with its sub routes if available e.g feed/uuid/details
          routes: <RouteBase>[
            GoRoute(
              path: '/feed',
              builder: (context, state) => const FeedPage(),
              routes: <RouteBase>[
                GoRoute(
                  path: 'detail',
                  builder: (context, state) => const FeedDetailsPage(),
                )
              ],
            ),
          ],
        ),

        // The route branch for 2º Tab
        StatefulShellBranch(routes: <RouteBase>[
          // Add this branch routes
          // each routes with its sub routes if available e.g shope/uuid/details
          GoRoute(
            path: '/shope',
            builder: (context, state) => const ShopePage(),
          ),
        ])
      ],
    ),
  ],
);

```

## Guards

특정 route를 보호하려면 (예. 인증받지 않은 유저들에 대해) global `redirect`를 설정할 수 있다. 가장 일반적인 예시로, 유저가 로그인되지 않은 상태일 때 `/login`으로 redirect시키는 것을 생각할 수 있다. 

`redirect`는 `GoRouterRedirect`type의 콜백이다. 
